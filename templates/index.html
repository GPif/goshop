<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoShop - Shopping List</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="max-w-2xl mx-auto px-4">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">Shopping List</h1>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <form id="addForm" class="flex gap-2">
                <input
                    type="text"
                    id="itemInput"
                    placeholder="Add new item..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required
                >
                <button
                    type="submit"
                    class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
                >
                    Add
                </button>
            </form>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <ul id="itemList" class="space-y-3">
                {{range .Items}}
                <li class="flex items-center justify-between p-3 border-b border-gray-100 last:border-0" data-id="{{.ID}}">
                    <div class="flex items-center gap-3">
                        <input
                            type="checkbox"
                            {{if .Completed}}checked{{end}}
                            onchange="toggleItem({{.ID}})"
                            class="w-5 h-5 text-blue-500 rounded focus:ring-blue-500"
                        >
                        <span class="{{if .Completed}}line-through text-gray-400{{else}}text-gray-700{{end}} text-lg">
                            {{.Title}}
                        </span>
                    </div>
                    <div class="flex gap-2">
                        <button
                            onclick="editItem({{.ID}})"
                            class="px-3 py-1 text-sm text-blue-500 hover:text-blue-700"
                        >
                            Edit
                        </button>
                        <button
                            onclick="deleteItem({{.ID}})"
                            class="px-3 py-1 text-sm text-red-500 hover:text-red-700"
                        >
                            Delete
                        </button>
                    </div>
                </li>
                {{end}}
            </ul>
            <p id="emptyMsg" class="text-gray-500 text-center py-8 {{if .Items}}hidden{{end}}">No items yet. Add some!</p>
        </div>
    </div>

    <script>
        const API_URL = '/items';

        async function addItem() {
            const input = document.getElementById('itemInput');
            const title = input.value.trim();
            if (!title) return;

            await fetch(API_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title})
            });

            input.value = '';
            location.reload();
        }

        document.getElementById('addForm').addEventListener('submit', (e) => {
            e.preventDefault();
            addItem();
        });

        async function toggleItem(id) {
            await fetch(`${API_URL}/${id}/toggle`, {method: 'PATCH'});
            location.reload();
        }

        async function deleteItem(id) {
            if (!confirm('Delete this item?')) return;
            await fetch(`${API_URL}/${id}`, {method: 'DELETE'});
            location.reload();
        }

        async function editItem(id) {
            const li = document.querySelector(`li[data-id="${id}"]`);
            const span = li.querySelector('span');
            const newTitle = prompt('Edit item:', span.textContent);
            if (!newTitle) return;

            await fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title: newTitle})
            });

            location.reload();
        }
    </script>
</body>
</html>
